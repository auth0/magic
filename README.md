# magic
[![Build Status](https://www.travis-ci.org/auth0/magic.svg?branch=master)](https://travis-ci.org/auth0/magic)

A lightweight wrapper around the `crypto` interface to OpenSSL and the `libsodium` library to provide a standard cryptography API for internal use, consistent with best current practices recommended by the product security team at Auth0. Named not for what it is intended to do, but for [what it is intended to prevent](https://en.wikipedia.org/wiki/Magic_(cryptography)).

All public functions support both callbacks and promises (and therefore async/await), allowing easy integration into any preexisting codebase. All constructions requiring secret keys will generate them as necessary if they are not supplied, and return them for future use.


**WARNING**

Load auth0-magic before any process listener is added or remove all 'uncaughtException' process listeners right after requiring magic. auth0-magic currently
uses libsodium.js#0.7.6 which [removes all `uncaughtException`
listeners](https://github.com/jedisct1/libsodium.js/blob/71c59d304a1f24dbc90c3fe517b76b3ea9bde596/wrapper/libsodium-post.js)
during the module load .`libsodium.js` needs to do that because it is
generated by EMScripten which [adds listeners during
build](https://github.com/emscripten-core/emscripten/blob/8d692d5f9609e360d2ac9241dfcdef89a6d3cbc5/src/shell.js#L154-L165).
Related issue in libsodium.js repo [here](https://github.com/jedisct1/libsodium.js/issues/59)

## Install
```
npm install auth0-magic
```

## Usage

magic offers a variety of functions for the following cases:
* [Encryption](/docs/encryption)
  * Symmetric
  * Asymmetric
  * Stream encryption
* [Authentication](/docs/authentication)
  * Signing with PKI
  * HMAC
* [Password hashing](/docs/passwordHashing): 
  * argon2
  * bcrypt

magic also offers a variety of [utility functions](/docs/utils) including - but not limited to: 
 * RSA key pair generation
 * Time safe comparison
 * UID generation
 * hashes

Magic implements a core and and alt API. The core api implements the recommended algorithms for each cryptographic operation. When in doubt, please use them. The alt api implements alternative algorithms for each cryptographic operation. They should only be used over the core api when required by an external specification or interoperability concerns.


### Notes

&ndash; As a recommendation, `magic` should always be used with [node.js buffers](https://nodejs.org/api/buffer.html) for all (non-boolean) inputs, with the exception of passwords. Due to the variety of tasks to which it may be put, the library attempts to be as unopinionated about encoding as it is opinionated about algorithms. There is minimal decoding functionality, which will attempt to break down any plaintext input as `utf-8` and any cryptographic input (keys, ciphertexts, macs, signatures, etc.) as `hex`. If as a consumer of this library you decide to depend on this builtin decoder it is recommended that you extensively test it to make sure your inputs are being parsed appropriately. When in doubt, it is always safer to parse them yourself and pass in binary data.
